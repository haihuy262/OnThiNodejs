<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Bootstrap Example</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  </head>
  <body>
    <div class="container mt-3">
      <h2 class="text-center">Danh sách xe máy</h2>
      <div class="mb-3">
        <input
          type="text"
          id="searchInput"
          class="form-control"
          placeholder="Tìm kiếm..."
        />
      </div>
      <table class="table mt-3" id="xeMayTable">
        <thead class="table-dark">
          <tr>
            <th>Tên xe</th>
            <th>Hãng sản xuất</th>
            <th>Ảnh xe máy</th>
            <th>Giá tiền</th>
            <th>Xoá</th>
            <th>Sửa</th>
          </tr>
        </thead>
        <tbody id="productTableBody"></tbody>
      </table>
    </div>
    <script>
      $(document).ready(function () {
        // Xác định đối tượng tìm kiếm
        const searchInput = $("#searchInput");
        // Xác định đối tượng bảng
        const table = $("#xeMayTable");
        // Xác định đối tượng dòng trong bảng
        const rows = $("#xeMayTable tbody tr");
        // Xử lý sự kiện khi người dùng nhập vào thanh tìm kiếm
        searchInput.on("input", function () {
          const searchTerm = $(this).val().toLowerCase();
          // Lặp qua mỗi dòng trong bảng để ẩn hoặc hiển thị dựa trên kết quả tìm kiếm
          rows.each(function () {
            const rowText = $(this).text().toLowerCase();
            if (rowText.includes(searchTerm)) {
              $(this).show();
            } else {
              $(this).hide();
            }
          });
        });
      });

      // Khi trang web đã tải xong (DOMContentLoaded), thực hiện hàm này
      document.addEventListener("DOMContentLoaded", async () => {
        try {
          // Gửi yêu cầu GET đến endpoint "/api/danhSachXeMay/xemay"
          const response = await fetch("/api/danhSachXeMay/xemay", {
            method: "GET",
            headers: {
              "Content-Type": "application/json",
            },
          });
          // Nếu yêu cầu không thành công, ném lỗi và kết thúc
          if (!response.ok) {
            throw new Error(`Lỗi HTTP! Trạng thái: ${response.status}`);
          }
          // Chuyển đổi dữ liệu nhận được thành đối tượng JSON
          const data = await response.json();
          // Gọi hàm populateTable để hiển thị dữ liệu lên bảng
          populateTable(data);
        } catch (error) {
          // Bắt lỗi nếu có lỗi trong quá trình lấy dữ liệu
          console.error("Lỗi khi lấy dữ liệu:", error);
        }
        // Hàm để điền dữ liệu vào bảng HTML
        function populateTable(data) {
          // Lấy thẻ tbody của bảng theo ID "productTableBody"
          const tableBody = document.getElementById("productTableBody");
          // Duyệt qua từng sản phẩm trong dữ liệu
          data.forEach((product) => {
            // Tạo một dòng mới trong bảng
            const row = document.createElement("tr");
            // Biến để lưu HTML của ảnh (avatar)
            let avatarHTML = "";
            // Kiểm tra nếu avatar là một mảng (nhiều ảnh)
            if (Array.isArray(product.anhXeMay)) {
              // Duyệt qua từng ảnh và thêm vào biến avatarHTML
              product.anhXeMay.forEach((image) => {
                avatarHTML += `<img src="/images/${image}" style="width: 50px; height: 50px;">`;
              });
            } else {
              // Nếu avatar là một chuỗi (một ảnh)
              avatarHTML = `<img src="/images/${product.anhXeMay}" style="width: 50px; height: 50px;">`;
            }
            // Điền thông tin sản phẩm vào dòng
            row.innerHTML = `
                <td>${product.tenXeMay}</td>
                <td>${product.hangSanXuat}</td>
                <td>${avatarHTML}</td>
                <td>${product.giaTien}</td>
            `;
            // Thêm dòng vào tbody của bảng
            tableBody.appendChild(row);
          });
        }
      });
    </script>
  </body>
</html>
